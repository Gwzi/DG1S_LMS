<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>글자 수 및 맞춤법 검사기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
        }
        .results {
            margin-top: 20px;
        }
        .corrected-text {
            white-space: pre-wrap;
        }
        .red_text {
            color: #bb2d3b;
        }
        .green_text {
            color: #07d307;
        }
        .blue_text {
            color: #0054ff;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>글자 수 및 맞춤법 검사기</h1>
    <textarea id="textInput" placeholder="여기에 글을 입력하세요..."></textarea>
    <div class="results">
        <p>글자 수: <span id="charCount">0</span></p>
        <p>바이트 수: <span id="byteCount">0</span></p>
        <p>맞춤법 검사 결과: <span id="spellCheckResult">검사 전</span></p>
        <div class="corrected-text" id="correctedText"></div>
    </div>
    <button id="checkButton">맞춤법 검사</button>
    <script>
        $(document).ready(function() {
            $('#textInput').on('input', function() {
                const text = $(this).val();
                updateCounts(text);
            });

            $('#checkButton').on('click', function() {
                const text = $('#textInput').val();
                checkSpelling(text);
            });

            function updateCounts(text) {
                const charCount = text.length;
                const byteCount = getByteCount(text);
                $('#charCount').text(charCount);
                $('#byteCount').text(byteCount);
            }

            function getByteCount(text) {
                let byteCount = 0;
                for (let i = 0; i < text.length; i++) {
                    const char = text.charAt(i);
                    if (char.match(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/)) {
                        byteCount += 3;
                    } else if (char === '\n') {
                        byteCount += 2;
                    } else {
                        byteCount += 1;
                    }
                }
                return byteCount;
            }

            function checkSpelling(text) {
                const url = "https://m.search.naver.com/p/csearch/ocontent/util/SpellerProxy";
                const params = {
                    "passportKey": "bc39621223a128b948d3e8748a175a2263e575ac",
                    "callback": "spellCheckCallback",
                    "q": text,
                    "where": "nexearch",
                    "color_blindness": 0,
                    "_": new Date().getTime()
                };

                $.ajax({
                    url: url,
                    data: params,
                    dataType: "jsonp",
                    jsonpCallback: "spellCheckCallback",
                    success: function(response) {
                        console.log('Success:', response); // 디버깅용 로그
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', status, error); // 디버깅용 로그
                        $('#spellCheckResult').text('맞춤법 검사 실패');
                    }
                });
            }

            window.spellCheckCallback = function(response) {
                console.log('spellCheckCallback:', response); // 디버깅용 로그
                const result = response.message.result;
                if (result.errata_count > 0) {
                    $('#spellCheckResult').html(result.errata_list.map(err => `${err.orgStr} => ${err.candWord}`).join(', '));
                    $('#correctedText').html(result.html); // HTML 렌더링
                } else {
                    $('#spellCheckResult').html('맞춤법 오류 없음');
                    $('#correctedText').html('모든 문장이 올바르게 작성되었습니다.');
                }
            }

        });

    </script>
</body>
</html>
